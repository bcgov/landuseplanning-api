apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: lup-api-build-deploy-dev
  namespace: e8b9ad-tools
  labels:
    app: landuseplanning
    env: dev
    name: lup-api
spec:
  params: []
  resources: []
  workspaces: []
  tasks:
    - name: build-api
      taskRef:
        name: openshift-client
        kind: ClusterTask
      params:
        - name: SCRIPT
          value: |
            oc start-build landuseplanning-api --follow --wait
    - name: deploy-to-dev
      params:
        - name: SCRIPT
          value: |
            oc tag landuseplanning-api:latest landuseplanning-api:dev
      runAfter:
        - build-api
      taskRef:
        kind: ClusterTask
        name: openshift-client
  finally:
    - name: push-to-teams-success
      params:
        - name: webhook-url
          value: # webhook url generated by MS Teams
        - name: webhook-payload
          value: # json format, using something from https://messagecardplayground.azurewebsites.net/ as a starter
      taskRef:
        kind: Task
        name: push-to-teams
      when:
        - input: $(tasks.status)
          operator: notin
          values:
            - Failed
    - name: push-to-teams-failure
      params:
        - name: webhook-url
          value: # webhook url generated by MS Teams
        - name: webhook-payload
          value: # json format, using something from https://messagecardplayground.azurewebsites.net/ as a starter
      taskRef:
        kind: Task
        name: push-to-teams
      when:
        - input: $(tasks.status)
          operator: in
          values:
            - Failed
