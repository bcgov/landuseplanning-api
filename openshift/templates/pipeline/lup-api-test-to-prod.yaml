apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: lup-api-deploy-prod
  namespace: e8b9ad-tools
  labels:
    app: landuseplanning
    env: prod
    name: lup-api
spec:
  params: []
  resources: []
  workspaces: []
  tasks:
    - name: deploy-to-prod
      params:
        - name: SCRIPT
          value: |
            oc tag landuseplanning-api:test landuseplanning-api:prod
      taskRef:
        kind: ClusterTask
        name: openshift-client
  finally:
    - name: push-to-teams-success
      params:
        - name: webhook-url
          value: # webhook url generated by MS Teams
        - name: webhook-payload
          value: # json format, using something from https://messagecardplayground.azurewebsites.net/ as a starter
      taskRef:
        kind: Task
        name: push-to-teams
      when:
        - input: $(tasks.status)
          operator: notin
          values:
            - Failed
    - name: push-to-teams-failure
      params:
        - name: webhook-url
          value: # webhook url generated by MS Teams
        - name: webhook-payload
          value: # json format, using something from https://messagecardplayground.azurewebsites.net/ as a starter
      taskRef:
        kind: Task
        name: push-to-teams
      when:
        - input: $(tasks.status)
          operator: in
          values:
            - Failed
